<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫ßn Duy B·∫£o's Dynamic FB</title>
    
    <style>
        /* CSS Variables for theming */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #050505;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --border-color: #ddd;
            --fb-blue: #1877f2;
            --input-bg: #e4e6eb;
            --input-border: #ddd;
            --action-btn-bg: #e4e6eb;
            --action-btn-text: #000;
        }

        .night-mode {
            --bg-color: #1a1a1a; /* Dark background */
            --text-color: #e4e6eb; /* Light text */
            --card-bg: #242526; /* Darker card background */
            --header-bg: #242526; /* Darker header */
            --border-color: #3e4042; /* Darker borders */
            --fb-blue: #2d88ff; /* Slightly different blue for dark mode */
            --input-bg: #3a3b3c; /* Dark input background */
            --input-border: #3a3b3c; /* Dark input border */
            --action-btn-bg: #3a3b3c;
            --action-btn-text: #e4e6eb;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color); 
            margin: 0;
            font-family: Arial, sans-serif;
            transition: background-color 0.3s ease; /* Smooth transition for theme change */
        }

        /* 1. The Phone's Outer Body */
        .iphone-container {
            position: relative;
        }

        .iphone-frame {
            width: 390px;
            height: 800px;
            background: #000; 
            border: 10px solid #222; 
            border-radius: 60px;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.5), 
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden; 
        }

        /* 2. The Screen Area */
        .screen {
            width: 100%;
            height: 100%;
            background: var(--card-bg); /* Screen background uses card_bg for theme */
            border-radius: 50px; 
            position: relative;
            overflow-y: scroll; 
            overflow-x: hidden;
            transition: background-color 0.3s ease;
        }
        
        /* Hide scrollbar for aesthetics */
        .screen::-webkit-scrollbar {
            display: none;
        }
        .screen {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }


        /* 3. Dynamic Island Base Position */
        .dynamic-island-wrapper {
            position: absolute;
            width: 100%;
            padding-top: 15px; 
            text-align: center;
            z-index: 10;
        }

        #dynamic-island {
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            background: #000;
            color: white;
            border-radius: 20px; 
            transition: all 0.3s ease-in-out; 
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            overflow: hidden; /* Hide overflow content when collapsed */
        }

        #vietnam-time {
            color: white; 
            transition: all 0.3s;
        }
        
        /* --- STATE 1: IDLE / COLLAPSED (Small Pill) --- */
        .island-collapsed {
            width: 120px;
            height: 32px;
            padding: 0;
        }
        .island-collapsed #island-content {
            opacity: 1; /* Time and Camera */
            padding: 0 15px;
            justify-content: space-between;
        }
        .island-collapsed #music-shrunk-info, 
        .island-collapsed #music-expanded-card {
            display: none;
        }


        /* --- STATE 2: MUSIC SHRUNK (Slightly Wider Pill with Music Info) --- */
        /* This state is now what the island defaults to when music is active and NOT expanded */
        .shrunk-music {
            width: 250px; /* Wider than standard collapsed for audio status */
            height: 37px;
            border-radius: 20px;
            padding: 0 10px;
            justify-content: flex-start;
        }

        .shrunk-music #island-content {
            padding: 0;
            opacity: 1;
            justify-content: flex-start;
            gap: 12px;
        }

        .shrunk-music #vietnam-time {
            display: block !important;
            opacity: 1;
            width: auto;
        }
        
        .shrunk-music #music-shrunk-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .shrunk-music #music-expanded-card {
            display: none;
        }
        
        #audio-active-dot {
            width: 8px;
            height: 8px;
            background-color: #8c8c8c; /* Default grey dot */
            border-radius: 50%;
            margin-left: auto; /* Push to the right */
        }

        /* --- STATE 3: MUSIC EXPANDED (The Full Player) --- */
        .expanded-music {
            width: 350px; 
            height: 400px; /* Large expanded card height */
            border-radius: 40px;
            align-items: flex-start; /* Align content to the top */
            padding: 15px 15px 25px 15px;
            background: #000;
        }
        
        .expanded-music #island-content {
            display: none; 
        }
        
        .expanded-music #music-expanded-card {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        .expanded-music #vietnam-time {
            display: none;
        }
        
        /* Expanded Card Header (Top Bar) */
        .expanded-card-header {
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #999;
            margin-bottom: 20px;
        }

        /* Album Art and Details */
        .album-info {
            display: flex;
            gap: 15px;
            width: 100%;
            margin-bottom: 25px;
        }
        
        #album-art {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .track-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .track-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 4px;
        }
        
        .track-artist {
            font-size: 16px;
            color: #ccc;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            margin-bottom: 25px;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #333;
            border-radius: 2px;
            margin-bottom: 5px;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            width: 65%; /* Simulated current position */
            background-color: #fff; /* White progress */
            border-radius: 2px;
        }
        
        .time-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
        }

        /* Media Controls */
        .media-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }
        
        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            padding: 5px;
            transition: opacity 0.2s;
        }
        
        .control-btn:hover {
            opacity: 0.7;
        }
        
        .play-pause-btn {
            font-size: 50px;
        }

        /* Volume/Airplay Controls */
        .volume-airplay {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 20px;
            color: #ccc;
        }
        
        /* --- NEW SOUNDWAVE STYLES --- */
        .soundwave-container {
            display: flex;
            align-items: center; /* Center bars vertically */
            height: 20px; /* Overall height for the shrunk visualizer */
            gap: 2px; /* Space between bars */
            overflow: hidden; /* Keep bars within bounds */
            position: relative;
            width: 40px; /* Fixed width for shrunk visualizer */
            justify-content: center;
        }
        
        #expanded-visualizer.soundwave-container {
            height: 50px; /* Taller for expanded visualizer */
            width: 100%; /* Take full width */
            margin-top: auto; /* Push to bottom */
            filter: opacity(0.5);
            justify-content: space-around; /* Distribute bars */
        }

        .soundwave-bar {
            width: 4px; /* Width of each bar */
            height: 2px; /* Minimum height when not active */
            background-color: #fff; /* Default white color */
            border-radius: 1px; /* Rounded ends */
            transition: height 0.1s ease-out, background-color 0.1s ease-out; /* Smooth animation */
            transform-origin: bottom; /* Grow from the bottom */
        }
        
        /* --- FACEBOOK APP STYLING --- */

        .facebook-app {
            padding-top: 55px; 
            height: calc(100% - 55px);
            background-color: var(--bg-color); 
            transition: background-color 0.3s ease;
        }

        .fb-header {
            background-color: var(--header-bg); 
            padding: 10px 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky; 
            top: 0;
            z-index: 5;
            transition: background-color 0.3s ease;
        }

        .fb-logo {
            font-size: 26px;
            font-weight: bold;
            color: var(--fb-blue); 
            text-align: left;
        }

        .fb-post-card {
            background-color: var(--card-bg);
            margin: 10px 0;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 1px solid #eee;
        }

        .user-details {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-name {
            font-weight: 700;
            font-size: 14px;
            color: var(--text-color); 
            margin-right: 5px;
            transition: color 0.3s ease;
        }
        
        .verified-tick {
            display: inline-block;
            width: 16px; 
            height: 16px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%231877F2' d='M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.707 7.707-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11.5 12.086l3.293-3.293a1 1 0 0 1 1.414 1.414z'/>
                </svg>");
            background-size: cover;
            margin-top: -3px; 
            margin-left: 2px;
            flex-shrink: 0; 
            transition: filter 0.3s ease; 
        }

        .post-time {
            font-size: 12px;
            color: #606770; 
            width: 100%; 
        }

        .post-content {
            margin-bottom: 15px;
        }

        #video-player {
            background-color: #000;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 14px;
            margin-bottom: 10px;
        }

        #video-player iframe {
            display: block;
        }

        #target-text {
            font-size: 18px;
            font-weight: bold;
            padding: 10px 0;
            color: var(--text-color); 
            transition: color 0.3s ease; 
        }

        .post-actions-bar {
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            transition: border-color 0.3s ease;
        }

        .action-btn {
            background-color: var(--action-btn-bg);
            color: var(--action-btn-text);
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s, color 0.2s;
        }

        .action-btn:hover {
            background-color: var(--border-color); 
        }

        .video-btn, .avatar-btn {
            background-color: var(--fb-blue);
            color: white;
        }

        .video-btn:hover, .avatar-btn:hover {
            background-color: #166fe5; 
        }

        #youtube-link-input {
            flex-grow: 1; 
            padding: 6px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 12px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        #name-color-input, #tick-color-input {
            width: 80px;
            padding: 4px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

    </style>
</head>
<body class=""> 
    <div class="iphone-container">
        <div class="iphone-frame">
            <div class="screen">
                
                <div class="dynamic-island-wrapper">
                    <div id="dynamic-island" class="island-collapsed">
                        
                        <div id="island-content">
                            <span id="vietnam-time">09:41</span>
                            
                            <div id="music-shrunk-info" style="display: none;">
                                <span style="font-size: 14px; margin-right: 5px;">0:08</span>
                                <div id="audio-visualizer" class="soundwave-container">
                                    <div class="soundwave-bar"></div>
                                    <div class="soundwave-bar"></div>
                                    <div class="soundwave-bar"></div>
                                    <div class="soundwave-bar"></div>
                                    <div class="soundwave-bar"></div>
                                </div>
                                <span id="audio-active-dot"></span>
                            </div>

                            <span style="font-size: 14px;"></span>
                        </div>
                        
                        <div id="music-expanded-card" style="display: none;">
                            <div class="expanded-card-header">
                                <span>Entropy</span>
                                <span id="expanded-card-visualizer-icon">|||</span>
                            </div>

                            <div class="album-info">
                                <img id="album-art" src="https://via.placeholder.com/100/551A8B/FFFFFF?text=Album+Art" alt="Album Art">
                                <div class="track-details">
                                    <span class="track-title">Entropy</span>
                                    <span class="track-artist">Beach Bunny</span>
                                </div>
                            </div>
                            
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <div class="time-labels">
                                    <span>2:50</span>
                                    <span>-0:51</span>
                                </div>
                            </div>

                            <div class="media-controls">
                                <button class="control-btn">‚èÆ</button>
                                <button class="control-btn play-pause-btn">‚ùö‚ùö</button>
                                <button class="control-btn">‚è≠</button>
                            </div>
                            
                            <div class="volume-airplay">
                                <span>üîà</span>
                                <span>üì∂</span>
                            </div>

                            <div id="expanded-visualizer" class="soundwave-container">
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                                <div class="soundwave-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="facebook-app">
                    
                    <div class="fb-header">
                        <h1 class="fb-logo">facebook</h1>
                    </div>

                    <div class="fb-post-card">
                        
                        <div class="post-header">
                            <img id="avatar-image" src="https://via.placeholder.com/50/007bff/ffffff?text=TD" alt="User Avatar" class="profile-avatar">
                            <div class="user-details">
                                <span class="user-name" id="userName">Tr·∫ßn Duy B·∫£o</span>
                                <span class="verified-tick" id="verifiedTick" title="Verified"></span>
                                <p class="post-time">1 min ago</p>
                            </div>
                        </div>
                        
                        <div class="post-content">
                            <div id="video-player">
                                <p>Paste a YouTube link below and press 'Load Video'</p>
                            </div>
                            <h3 id="target-text">This is the text that will change colors!</h3>
                        </div>
                        
                        <div class="post-actions-bar">
                            
                            <button id="change-text-btn" class="action-btn video-btn">‚úèÔ∏è Change Post Text</button>
                            
                            <button id="change-name-btn" class="action-btn avatar-btn">üë§ Change Name</button>
                            <input type="file" id="avatar-file-input" accept="image/*" style="display: none;">
                            <button id="upload-avatar-btn" class="action-btn avatar-btn">üì∑ Upload Avatar</button>
                            
                            <button id="rgb-header-btn" class="action-btn video-btn">üåà Cycle Header</button>

                            <div class="color-buttons">
                                <button id="rainbow-text-btn" class="action-btn">üåà Rainbow</button>
                                <button id="rgb-text-btn" class="action-btn">üé® RGB Cycle</button>
                                <button id="random-text-btn" class="action-btn">üé≤ Random</button>
                            </div>
                            
                            <input type="text" id="youtube-link-input" placeholder="Paste YouTube Link">
                            <button id="load-video-btn" class="action-btn video-btn">‚ñ∂ Load Video</button>
                            
                            <button id="toggle-night-mode-btn" class="action-btn">üåô Night Mode</button>
                            
                            <div style="width: 100%; display: flex; gap: 8px; margin-top: 5px; align-items: center;">
                                <label for="name-color-input" style="font-size: 12px; color: var(--text-color);">Name Color:</label>
                                <input type="color" id="name-color-input" value="#050505">
                                <label for="tick-color-input" style="font-size: 12px; color: var(--text-color);">Tick Color:</label>
                                <input type="color" id="tick-color-input" value="#1877f2">
                            </div>
                        </div>
                        
                    </div>
                    
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // --- Element Selection ---
        const body = document.body;
        const island = document.getElementById('dynamic-island');
        const timeDisplay = document.getElementById('vietnam-time');
        const youtubeLinkInput = document.getElementById('youtube-link-input');
        const loadVideoBtn = document.getElementById('load-video-btn');
        const videoPlayerDiv = document.getElementById('video-player');
        
        // --- Music Player Specific Elements ---
        const musicShrunkInfo = document.getElementById('music-shrunk-info');
        const musicExpandedCard = document.getElementById('music-expanded-card');
        const audioDot = document.getElementById('audio-active-dot');

        // NEW Soundwave elements
        const shrunkSoundwaveContainer = document.getElementById('audio-visualizer');
        const expandedSoundwaveContainer = document.getElementById('expanded-visualizer');
        let shrunkSoundwaveBars; // Will be populated dynamically
        let expandedSoundwaveBars; // Will be populated dynamically


        // --- Profile Elements ---
        const changeNameBtn = document.getElementById('change-name-btn'); 
        const uploadAvatarBtn = document.getElementById('upload-avatar-btn'); 
        const avatarFileInput = document.getElementById('avatar-file-input'); 
        const avatarImage = document.getElementById('avatar-image'); 
        const userNameSpan = document.getElementById('userName'); 

        // --- Text/Color Elements ---
        const targetText = document.getElementById('target-text');
        const changeTextBtn = document.getElementById('change-text-btn'); 
        const rainbowBtn = document.getElementById('rainbow-text-btn');
        const rgbBtn = document.getElementById('rgb-text-btn');
        const randomBtn = document.getElementById('random-text-btn');
        const toggleNightModeBtn = document.getElementById('toggle-night-mode-btn');
        const rgbHeaderBtn = document.getElementById('rgb-header-btn'); 
        const verifiedTickSpan = document.getElementById('verifiedTick');
        const nameColorInput = document.getElementById('name-color-input');
        const tickColorInput = document.getElementById('tick-color-input');

        // --- State Variables ---
        let rgbInterval;
        let headerRgbInterval; 
        let soundwaveAnimationInterval; // Renamed for clarity
        let isNightMode = false;
        let hue = 0;
        let musicActive = false; 
        let islandState = 'collapsed'; // 'collapsed', 'shrunk-music', 'expanded-music'

        // Initialize soundwave bars after the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            shrunkSoundwaveBars = Array.from(shrunkSoundwaveContainer.querySelectorAll('.soundwave-bar'));
            expandedSoundwaveBars = Array.from(expandedSoundwaveContainer.querySelectorAll('.soundwave-bar'));
        });


        // ===================================
        // --- DYNAMIC ISLAND 2-STATE LOGIC ---
        // ===================================

        function updateIslandClasses() {
            // 1. Remove all custom state classes
            island.classList.remove('island-collapsed', 'shrunk-music', 'expanded-music');
            
            // 2. Set the appropriate class based on the current state
            island.classList.add(islandState);

            const isMusicPlaying = musicActive;

            // 3. Toggle visibility of content divs and soundwave
            if (islandState === 'collapsed') {
                musicShrunkInfo.style.display = 'none';
                musicExpandedCard.style.display = 'none';
                timeDisplay.style.display = 'block'; 
                stopSoundwave(); // Ensure soundwave stops when collapsed

            } else if (islandState === 'shrunk-music' && isMusicPlaying) {
                // Small music pill state
                musicShrunkInfo.style.display = 'flex';
                musicExpandedCard.style.display = 'none';
                timeDisplay.style.display = 'block';
                startSoundwave(shrunkSoundwaveBars, shrunkSoundwaveContainer.clientHeight); 

            } else if (islandState === 'expanded-music' && isMusicPlaying) {
                // Full player card state
                musicShrunkInfo.style.display = 'none';
                musicExpandedCard.style.display = 'flex';
                timeDisplay.style.display = 'none';
                // Use expandedSoundwaveContainer.clientHeight to get the correct max height for expanded bars
                startSoundwave(expandedSoundwaveBars, expandedSoundwaveContainer.clientHeight); 
            
            } else {
                // Fallback: If no music is active, always show idle/collapsed
                islandState = 'collapsed';
                updateIslandClasses(); 
            }
        }
        
        island.addEventListener('click', () => {
            if (!musicActive) {
                 // Simple toggle for general expansion if no video is loaded
                 if (islandState === 'collapsed') {
                     islandState = 'shrunk-music'; // Using shrunk-music for general visual expansion
                 } else {
                     islandState = 'collapsed';
                 }
            } else {
                // Music is active, cycle between shrunk-music (small) and expanded-music (large)
                if (islandState === 'shrunk-music') {
                    islandState = 'expanded-music';
                } else {
                    islandState = 'shrunk-music';
                }
            }
            updateIslandClasses();
        });


        // ===================================
        // --- NEW TEXT CHANGE LOGIC ---
        // ===================================

        changeTextBtn.addEventListener('click', () => {
            const newText = prompt('Enter the new text for the post title:');
            
            if (newText !== null) {
                resetText(); // Stop any current color animation first
                targetText.textContent = newText.trim() || 'This is the text that will change colors!';
            }
        });


        // ===================================
        // --- ORIGINAL-STYLE SOUNDWAVE LOGIC ---
        // ===================================

        function startSoundwave(bars, maxHeight) {
            if (soundwaveAnimationInterval) {
                clearInterval(soundwaveAnimationInterval);
            }
            
            // Set initial display for the container
            if (bars === shrunkSoundwaveBars) {
                shrunkSoundwaveContainer.style.display = 'flex';
                expandedSoundwaveContainer.style.display = 'none';
            } else {
                shrunkSoundwaveContainer.style.display = 'none';
                expandedSoundwaveContainer.style.display = 'flex';
            }

            soundwaveAnimationInterval = setInterval(() => {
                hue = (hue + 5) % 360; // Faster color cycling for soundwave
                const baseColor = `hsl(${hue}, 100%, 70%)`;
                audioDot.style.backgroundColor = baseColor; 

                bars.forEach((bar, index) => {
                    // Random height for each bar, relative to the container's height        .expanded-music {
            width: 350px; 
            height: 400px; /* Large expanded card height */
            border-radius: 40px;
            align-items: flex-start; /* Align content to the top */
            padding: 15px 15px 25px 15px;
            background: #000;
        }
        
        .expanded-music #island-content {
            display: none; /* Hide the simple time/visualizer wrapper */
        }
        
        .expanded-music #music-expanded-card {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        .expanded-music #vietnam-time {
            display: none;
        }
        
        /* Expanded Card Header (Top Bar) */
        .expanded-card-header {
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #999;
            margin-bottom: 20px;
        }

        /* Album Art and Details */
        .album-info {
            display: flex;
            gap: 15px;
            width: 100%;
            margin-bottom: 25px;
        }
        
        #album-art {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .track-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .track-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 4px;
        }
        
        .track-artist {
            font-size: 16px;
            color: #ccc;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            margin-bottom: 25px;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #333;
            border-radius: 2px;
            margin-bottom: 5px;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            width: 65%; /* Simulated current position */
            background-color: #fff; /* White progress */
            border-radius: 2px;
        }
        
        .time-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
        }

        /* Media Controls */
        .media-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }
        
        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            padding: 5px;
            transition: opacity 0.2s;
        }
        
        .control-btn:hover {
            opacity: 0.7;
        }
        
        .play-pause-btn {
            font-size: 50px;
        }

        /* Volume/Airplay Controls */
        .volume-airplay {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 20px;
            color: #ccc;
        }
        
        /* The Music Visualizer in the Expanded State */
        #expanded-visualizer {
            width: 100%;
            height: 50px; /* Reduced height for bottom placement */
            border-radius: 0;
            background: transparent;
            margin-top: auto; /* Push to the bottom */
            filter: opacity(0.5);
        }

        /* Soundwave Styling (reused) */
        @keyframes pulse {
            0% { transform: scaleY(1); opacity: 0.8; }
            50% { transform: scaleY(1.2); opacity: 1; }
            100% { transform: scaleY(1); opacity: 0.8; }
        }
        .simulated-soundwave {
            animation: pulse 1s infinite alternate;
            /* Gradient set via JS */
        }
        
        /* --- FACEBOOK APP STYLING --- (Unchanged for FB functionality) */

        .facebook-app {
            padding-top: 55px; 
            height: calc(100% - 55px);
            background-color: var(--bg-color); 
            transition: background-color 0.3s ease;
        }

        .fb-header {
            background-color: var(--header-bg); 
            padding: 10px 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky; 
            top: 0;
            z-index: 5;
            transition: background-color 0.3s ease;
        }

        .fb-logo {
            font-size: 26px;
            font-weight: bold;
            color: var(--fb-blue); 
            text-align: left;
        }

        .fb-post-card {
            background-color: var(--card-bg);
            margin: 10px 0;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 1px solid #eee;
        }

        .user-details {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-name {
            font-weight: 700;
            font-size: 14px;
            color: var(--text-color); 
            margin-right: 5px;
            transition: color 0.3s ease;
        }
        
        .verified-tick {
            display: inline-block;
            width: 16px; 
            height: 16px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%231877F2' d='M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.707 7.707-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11.5 12.086l3.293-3.293a1 1 0 0 1 1.414 1.414z'/%3E%3C/svg%3E");
            background-size: cover;
            margin-top: -3px; 
            margin-left: 2px;
            flex-shrink: 0; 
            transition: filter 0.3s ease; 
        }

        .post-time {
            font-size: 12px;
            color: #606770; 
            width: 100%; 
        }

        .post-content {
            margin-bottom: 15px;
        }

        #video-player {
            background-color: #000;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 14px;
            margin-bottom: 10px;
        }

        #video-player iframe {
            display: block;
        }

        #target-text {
            font-size: 18px;
            font-weight: bold;
            padding: 10px 0;
            color: var(--text-color); 
            transition: color 0.3s ease; 
        }

        .post-actions-bar {
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            transition: border-color 0.3s ease;
        }

        .action-btn {
            background-color: var(--action-btn-bg);
            color: var(--action-btn-text);
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s, color 0.2s;
        }

        .action-btn:hover {
            background-color: var(--border-color); 
        }

        .video-btn, .avatar-btn {
            background-color: var(--fb-blue);
            color: white;
        }

        .video-btn:hover, .avatar-btn:hover {
            background-color: #166fe5; 
        }

        #youtube-link-input {
            flex-grow: 1; 
            padding: 6px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 12px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        #name-color-input, #tick-color-input {
            width: 80px;
            padding: 4px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

    </style>
</head>
<body class=""> 
    <div class="iphone-container">
        <div class="iphone-frame">
            <div class="screen">
                
                <div class="dynamic-island-wrapper">
                    <div id="dynamic-island" class="island-collapsed">
                        
                        <div id="island-content">
                            <span id="vietnam-time">09:41</span>
                            
                            <div id="music-shrunk-info" style="display: none;">
                                <span style="font-size: 14px; margin-right: 5px;">0:08</span>
                                <canvas id="audio-visualizer"></canvas> 
                                <span id="audio-active-dot"></span>
                            </div>

                            <span style="font-size: 14px;"></span>
                        </div>
                        
                        <div id="music-expanded-card" style="display: none;">
                            <div class="expanded-card-header">
                                <span>Entropy</span>
                                <span id="expanded-card-visualizer-icon">|||</span>
                            </div>

                            <div class="album-info">
                                <img id="album-art" src="https://via.placeholder.com/100/551A8B/FFFFFF?text=Album+Art" alt="Album Art">
                                <div class="track-details">
                                    <span class="track-title">Entropy</span>
                                    <span class="track-artist">Beach Bunny</span>
                                </div>
                            </div>
                            
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <div class="time-labels">
                                    <span>2:50</span>
                                    <span>-0:51</span>
                                </div>
                            </div>

                            <div class="media-controls">
                                <button class="control-btn">‚èÆ</button>
                                <button class="control-btn play-pause-btn">‚ùö‚ùö</button>
                                <button class="control-btn">‚è≠</button>
                            </div>
                            
                            <div class="volume-airplay">
                                <span>üîà</span>
                                <span>üì∂</span>
                            </div>

                            <canvas id="expanded-visualizer" class="simulated-soundwave"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="facebook-app">
                    
                    <div class="fb-header">
                        <h1 class="fb-logo">facebook</h1>
                    </div>

                    <div class="fb-post-card">
                        
                        <div class="post-header">
                            <img id="avatar-image" src="https://via.placeholder.com/50/007bff/ffffff?text=TD" alt="User Avatar" class="profile-avatar">
                            <div class="user-details">
                                <span class="user-name" id="userName">Tr·∫ßn Duy B·∫£o</span>
                                <span class="verified-tick" id="verifiedTick" title="Verified"></span>
                                <p class="post-time">1 min ago</p>
                            </div>
                        </div>
                        
                        <div class="post-content">
                            <div id="video-player">
                                <p>Paste a YouTube link below and press 'Load Video'</p>
                            </div>
                            <h3 id="target-text">This is the text that will change colors!</h3>
                        </div>
                        
                        <div class="post-actions-bar">
                            
                            <button id="change-name-btn" class="action-btn avatar-btn">üë§ Change Name</button>
                            <input type="file" id="avatar-file-input" accept="image/*" style="display: none;">
                            <button id="upload-avatar-btn" class="action-btn avatar-btn">üì∑ Upload Avatar</button>
                            
                            <button id="rgb-header-btn" class="action-btn video-btn">üåà Cycle Header</button>

                            <div class="color-buttons">
                                <button id="rainbow-text-btn" class="action-btn">üåà Rainbow</button>
                                <button id="rgb-text-btn" class="action-btn">üé® RGB Cycle</button>
                                <button id="random-text-btn" class="action-btn">üé≤ Random</button>
                            </div>
                            
                            <input type="text" id="youtube-link-input" placeholder="Paste YouTube Link">
                            <button id="load-video-btn" class="action-btn video-btn">‚ñ∂ Load Video</button>
                            
                            <button id="toggle-night-mode-btn" class="action-btn">üåô Night Mode</button>
                            
                            <div style="width: 100%; display: flex; gap: 8px; margin-top: 5px; align-items: center;">
                                <label for="name-color-input" style="font-size: 12px; color: var(--text-color);">Name Color:</label>
                                <input type="color" id="name-color-input" value="#050505">
                                <label for="tick-color-input" style="font-size: 12px; color: var(--text-color);">Tick Color:</label>
                                <input type="color" id="tick-color-input" value="#1877f2">
                            </div>
                        </div>
                        
                    </div>
                    
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // --- Element Selection ---
        const body = document.body;
        const island = document.getElementById('dynamic-island');
        const timeDisplay = document.getElementById('vietnam-time');
        const visualizerCanvas = document.getElementById('audio-visualizer');
        const youtubeLinkInput = document.getElementById('youtube-link-input');
        const loadVideoBtn = document.getElementById('load-video-btn');
        const videoPlayerDiv = document.getElementById('video-player');
        
        // --- Music Player Specific Elements (NEW) ---
        const musicShrunkInfo = document.getElementById('music-shrunk-info');
        const musicExpandedCard = document.getElementById('music-expanded-card');
        const expandedVisualizer = document.getElementById('expanded-visualizer');
        const audioDot = document.getElementById('audio-active-dot');


        // --- Profile Elements ---
        const changeNameBtn = document.getElementById('change-name-btn'); 
        const uploadAvatarBtn = document.getElementById('upload-avatar-btn'); 
        const avatarFileInput = document.getElementById('avatar-file-input'); 
        const avatarImage = document.getElementById('avatar-image'); 
        const userNameSpan = document.getElementById('userName'); 

        // --- Color Elements ---
        const targetText = document.getElementById('target-text');
        const rainbowBtn = document.getElementById('rainbow-text-btn');
        const rgbBtn = document.getElementById('rgb-text-btn');
        const randomBtn = document.getElementById('random-text-btn');
        const toggleNightModeBtn = document.getElementById('toggle-night-mode-btn');
        const rgbHeaderBtn = document.getElementById('rgb-header-btn'); 
        const verifiedTickSpan = document.getElementById('verifiedTick');
        const nameColorInput = document.getElementById('name-color-input');
        const tickColorInput = document.getElementById('tick-color-input');

        // --- State Variables ---
        let rgbInterval;
        let headerRgbInterval; 
        let soundwaveColorInterval;
        let isNightMode = false;
        let hue = 0;
        let musicActive = false; // Flag to indicate if music is currently "playing"
        let islandState = 'collapsed'; // 'collapsed', 'shrunk-music', 'expanded-music'

        // ===================================
        // --- DYNAMIC ISLAND 3-STATE LOGIC ---
        // ===================================

        function updateIslandClasses() {
            // Remove all custom state classes
            island.classList.remove('island-collapsed', 'shrunk-music', 'expanded-music');
            
            // Set the appropriate class based on the current state
            island.classList.add(islandState);

            // Toggle visibility of content divs
            const isMusicActive = musicActive; // Check if video is loaded

            if (islandState === 'collapsed') {
                musicShrunkInfo.style.display = 'none';
                musicExpandedCard.style.display = 'none';
                timeDisplay.style.display = 'block'; // Time visible in Idle state
                stopSoundwave();
            } else if (islandState === 'shrunk-music' && isMusicActive) {
                musicShrunkInfo.style.display = 'flex';
                musicExpandedCard.style.display = 'none';
                timeDisplay.style.display = 'block';
                startSoundwave(visualizerCanvas); // Start waveform on the small visualizer
            } else if (islandState === 'expanded-music' && isMusicActive) {
                musicShrunkInfo.style.display = 'none';
                musicExpandedCard.style.display = 'flex';
                timeDisplay.style.display = 'none';
                startSoundwave(expandedVisualizer); // Start waveform on the large visualizer
            } else {
                // If music is NOT active, revert to idle/collapsed view
                islandState = 'collapsed';
                updateIslandClasses(); 
            }
        }
        
        island.addEventListener('click', () => {
            if (!musicActive) {
                 // Simple toggle between collapsed/expanded (like the old state) if no music is active
                 if (islandState === 'collapsed') {
                     islandState = 'shrunk-music'; // Use 'shrunk-music' as a stand-in for general expansion
                 } else {
                     islandState = 'collapsed';
                 }
            } else {
                // Music is active, cycle through 3 states: shrunk -> expanded -> collapsed
                if (islandState === 'collapsed') {
                    islandState = 'shrunk-music';
                } else if (islandState === 'shrunk-music') {
                    islandState = 'expanded-music';
                } else {
                    islandState = 'collapsed';
                }
            }
            updateIslandClasses();
        });

        // ===================================
        // --- SOUNDWAVE & MUSIC CONTROL ---
        // ===================================

        function updateSoundwaveColor() {
            hue = (hue + 2) % 360; 
            const color1 = `hsl(${hue}, 100%, 50%)`;
            const color2 = `hsl(${(hue + 60) % 360}, 100%, 50%)`; 
            const color3 = `hsl(${(hue + 120) % 360}, 100%, 50%)`; 

            const gradient = `linear-gradient(to right, ${color1}, ${color2}, ${color3}, ${color2}, ${color1})`;
            
            // Apply gradient to BOTH visualizer elements (only one is visible at a time)
            visualizerCanvas.style.backgroundImage = gradient;
            expandedVisualizer.style.backgroundImage = gradient;
            audioDot.style.backgroundColor = color1; // Use the first color for the active dot
        }

        function startSoundwave(targetCanvas) {
            targetCanvas.style.display = 'block'; 
            targetCanvas.classList.add('simulated-soundwave');
            
            if (!soundwaveColorInterval) {
                soundwaveColorInterval = setInterval(updateSoundwaveColor, 100); 
            }
        }
        
        function stopSoundwave() {
            clearInterval(soundwaveColorInterval);
            soundwaveColorInterval = null;
            visualizerCanvas.classList.remove('simulated-soundwave');
            expandedVisualizer.classList.remove('simulated-soundwave');
            visualizerCanvas.style.display = 'none';
            expandedVisualizer.style.display = 'none';
        }

        // --- YouTube Video Player and Link Loader ---
        loadVideoBtn.addEventListener('click', () => {
            const link = youtubeLinkInput.value.trim();
            if (!link) {
                alert('Please paste a valid YouTube link.');
                return;
            }

            let videoId;
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = link.match(regex);

            if (match && match[1]) {
                videoId = match[1];
            } else {
                videoPlayerDiv.innerHTML = `<p style="color: red;">Invalid YouTube link format.</p>`;
                return;
            }

            const iframeHTML = `<iframe width="100%" height="200" 
                src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
                frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen></iframe>`;
                
            videoPlayerDiv.innerHTML = iframeHTML;
            
            // Activate music status and switch island to shrunk mode
            musicActive = true; 
            islandState = 'shrunk-music';
            updateIslandClasses();
        });


        // ===================================
        // --- PROFILE & COLOR LOGIC ---
        // ===================================
        
        // 1. Change Name Function
        changeNameBtn.addEventListener('click', () => {
            const newName = prompt('Enter the new name for your Facebook profile:');
            
            if (newName && newName.trim() !== "") {
                userNameSpan.textContent = newName.trim();
            } else if (newName !== null) {
                alert('Name cannot be empty.');
            }
        });

        // 2. Avatar File Uploader (Local File Upload)
        uploadAvatarBtn.addEventListener('click', () => {
            avatarFileInput.click();
        });

        avatarFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    avatarFileInput.value = ''; 
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    avatarImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // --- Utility Functions ---
        function resetHeaderColors() {
            clearInterval(headerRgbInterval);
            headerRgbInterval = null;
            timeDisplay.style.color = 'white'; 
            updateNameAndTickColors();
        }

        // --- Custom Name and Tick Color Update ---
        function updateNameAndTickColors(nameColor, tickColor) {
            const newNameColor = nameColor || nameColorInput.value;
            const newTickColor = tickColor || tickColorInput.value;

            userNameSpan.style.color = newNameColor;
            
            // Recreate SVG background with the new tick color
            const svgData = encodeURIComponent(`
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>
                    <path fill='${newTickColor}' d='M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.707 7.707-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11.5 12.086l3.293-3.293a1 1 0 0 1 1.414 1.414z'/>
                </svg>
            `);
            verifiedTickSpan.style.backgroundImage = `url("data:image/svg+xml,${svgData}")`;
        }

        // --- Header RGB Cycle Logic ---
        function startHeaderRgbCycle() {
            if (headerRgbInterval) {
                resetHeaderColors(); 
                return;
            }

            let step = 0;
            headerRgbInterval = setInterval(() => {
                const r = Math.sin(step) * 127 + 128;
                const g = Math.sin(step + 2) * 127 + 128;
                const b = Math.sin(step + 4) * 127 + 128;
                
                const rgbString = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;

                timeDisplay.style.color = rgbString;
                updateNameAndTickColors(rgbString, rgbString);

                step += 0.05; 
            }, 50);
        }

        // --- Event Listeners for Custom Colors and Toggles ---
        nameColorInput.addEventListener('input', () => {
            resetHeaderColors();
            updateNameAndTickColors();
        });
        tickColorInput.addEventListener('input', () => {
            resetHeaderColors();
            updateNameAndTickColors();
        });
        rgbHeaderBtn.addEventListener('click', startHeaderRgbCycle); 

        updateNameAndTickColors(); // Initial call

        // --- Night Mode Toggle ---
        toggleNightModeBtn.addEventListener('click', () => {
            isNightMode = !isNightMode;
            body.classList.toggle('night-mode', isNightMode);
            toggleNightModeBtn.textContent = isNightMode ? '‚òÄÔ∏è Light Mode' : 'üåô Night Mode';
            resetHeaderColors(); 
            updateNameAndTickColors();
        });

        // --- Vietnam Time Display ---
        function updateVietnamTime() {
            const options = { 
                timeZone: 'Asia/Ho_Chi_Minh', 
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: false 
            };
            const vnTime = new Date().toLocaleTimeString('en-US', options);
            timeDisplay.textContent = vnTime;
        }

        updateVietnamTime();
        setInterval(updateVietnamTime, 1000); 

        // --- Text Color Manipulation Functions ---
        function resetText() {
            clearInterval(rgbInterval); 
            targetText.innerHTML = targetText.textContent; 
            targetText.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color'); 
        }

        // A. Rainbow Text (Static Gradient)
        function setRainbowText(element) {
            resetText();
            const text = element.textContent;
            element.innerHTML = [...text].map((char, i) => {
                const hue = i * (360 / text.length);
                return `<span style="color: hsl(${hue}, 100%, 50%);">${char}</span>`;
            }).join('');
        }

        // B. RGB Cycle Text (Animated)
        function setRgbCycleText(element) {
            resetText();
            let step = 0;

            rgbInterval = setInterval(() => {
                const text = element.textContent;
                element.innerHTML = [...text].map((char, i) => {
                    const r = Math.sin(0.1 * i + step) * 127 + 128;
                    const g = Math.sin(0.1 * i + step + 2) * 127 + 128;
                    const b = Math.sin(0.1 * i + step + 4) * 127 + 128;
                    
                    return `<span style="color: rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)});">${char}</span>`;
                }).join('');
                
                step += 0.1; 
            }, 50); 
        }

        // C. Random Color Text (Static Random)
        function setRandomText(element) {
            resetText();
            const text = element.textContent;
            
            const randomColor = () => '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');

            element.innerHTML = [...text].map((char) => {
                return `<span style="color: ${randomColor()};">${char}</span>`;
            }).join('');
        }

        // Attach Event Listeners to Buttons
        rainbowBtn.addEventListener('click', () => setRainbowText(targetText));
        rgbBtn.addEventListener('click', () => setRgbCycleText(targetText));
        randomBtn.addEventListener('click', () => setRandomText(targetText));
    </script>
</body>
</html>
</html>
