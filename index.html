<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫ßn Duy B·∫£o's Dynamic FB</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS Variables for theming */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #050505; /* Black in light mode */
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --border-color: #ddd;
            --fb-blue: #1877f2;
            --input-bg: #e4e6eb;
            --input-border: #ddd;
            --action-btn-bg: #f5f5f5;
            --action-btn-text: #000;
        }

        .night-mode {
            --bg-color: #1a1a1a;
            --text-color: #e4e6eb; /* White in dark mode */
            --card-bg: #242526;
            --header-bg: #242526;
            --border-color: #3e4042;
            --fb-blue: #2d88ff;
            --input-bg: #3a3b3c;
            --input-border: #3a3b3c;
            --action-btn-bg: #3a3b3c;
            --action-btn-text: #e4e6eb;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color); 
            margin: 0;
            font-family: 'Inter', Arial, sans-serif;
            transition: background-color 0.3s ease; 
            position: relative; 
            overflow: hidden; 
        }

        /* NEW: Music Glow Background */
        #music-glow-background {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; 
            filter: blur(100px) opacity(0); 
            transition: background 0.5s ease-out, filter 0.5s ease-out; 
            z-index: 0; 
            pointer-events: none; 
        }

        /* 1. The Phone's Outer Body */
        .iphone-container {
            position: relative;
            z-index: 1; 
        }

        .iphone-frame {
            width: 390px;
            height: 800px;
            background: #e9e9e9; 
            border: 1px solid #c9c9c9; 
            border-radius: 60px;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.4), 
                inset 0 0 10px rgba(255, 255, 255, 0.5); 
            position: relative;
            overflow: hidden; 
        }

        /* 2. The Screen Area */
        .screen {
            width: calc(100% - 20px); 
            height: calc(100% - 20px); 
            margin: 10px;
            background: var(--card-bg); 
            border-radius: 50px; 
            position: relative;
            overflow-y: scroll; 
            overflow-x: hidden;
            transition: background-color 0.3s ease;
        }
        
        /* ·∫®n thanh cu·ªôn */
        .screen::-webkit-scrollbar {
            display: none;
        }
        .screen {
            -ms-overflow-style: none; 
            scrollbar-width: none; 
        }

        /* 3. Status Bar (Kh√¥ng thay ƒë·ªïi) */
        .status-bar {
            position: absolute;
            top: 15px; 
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            color: var(--text-color); 
            font-size: 13px;
            font-weight: 600; 
            z-index: 20;
            pointer-events: none;
        }
        
        /* --- NEW: iOS 17 Battery Icon CSS --- */
        .battery-container {
            width: 25px; 
            height: 12px;
            border: 1px solid currentColor;
            border-radius: 3px;
            position: relative;
            transition: border-color 0.05s linear; 
        }

        .battery-cap {
            width: 1.5px;
            height: 4px;
            background-color: currentColor;
            position: absolute;
            top: 4px;
            right: -3px;
            border-radius: 0 1px 1px 0;
            transition: background-color 0.05s linear; 
        }

        .battery-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease, background-color 0.5s ease, opacity 0.3s ease;
        }
        
        @keyframes blink {
            from, to { opacity: 1; }
            50% { opacity: 0; }
        }

        /* --- NEW: iOS 17 Signal/Wi-Fi Icon CSS --- */
        .icon-svg {
            width: 15px;
            height: 15px;
            fill: none;
            stroke: currentColor;
            stroke-width: 1.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke 0.05s linear;
        }

        /* Signal Bars */
        .signal-bar {
            width: 1px; 
            margin: 0 0.5px;
            background-color: currentColor;
            border-radius: 0.5px;
            transition: background-color 0.05s linear;
        }
        
        .signal-bar-1 { height: 4px; }
        .signal-bar-2 { height: 7px; }
        .signal-bar-3 { height: 10px; }
        .signal-bar-4 { height: 13px; }


        /* 4. V·ªã tr√≠ ƒê·∫£o ƒê·ªông (ƒê√É S·ª¨A L·ªñI V·ªä TR√ç) */
        .dynamic-island-wrapper {
            position: absolute;
            width: 100%;
            top: 10px; /* ƒê·∫∑t Dynamic Island ·ªü v·ªã tr√≠ c·ªë ƒë·ªãnh, kh√¥ng ph·ª• thu·ªôc v√†o padding-top */
            text-align: center;
            z-index: 10;
        }
        
        /* Camera/Sensor Notch Area (Notch g·ªëc - s·∫Ω b·ªã Dynamic Island che khi ho·∫°t ƒë·ªông) */
        #dynamic-island-notch {
            position: absolute;
            top: 5px; /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ Y c·ªßa Notch g·ªëc */
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 32px;
            background: #000;
            border-radius: 20px;
            z-index: 9;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        #dynamic-island {
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            background: #000;
            color: white;
            border-radius: 20px; 
            transition: all 0.3s ease-in-out, width 0.3s ease, height 0.3s ease, padding 0.3s ease, margin 0.3s ease; 
            cursor: pointer; 
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            overflow: hidden; 
            position: relative;
            z-index: 10;
            top: 5px; /* C·∫ßn thi·∫øt ƒë·ªÉ island n·∫±m ngang h√†ng v·ªõi notch */
        }
        
        #island-content {
            display: flex;
            align-items: center;
            height: 100%;
            width: 100%;
            transition: opacity 0.3s ease;
        }

        /* --- TR·∫†NG TH√ÅI 1: THU G·ªåN (ƒê√É S·ª¨A L·ªñI CƒÇN CH·ªàNH) --- */
        .island-collapsed {
            width: 45px; 
            height: 32px;
            padding: 0;
            margin-left: 0px; 
            /* D√πng transform ƒë·ªÉ di chuy·ªÉn DI Collapsed v√†o ƒë√∫ng v·ªã tr√≠ c·ªßa l·ªó kho√©t camera */
            transform: translateX(45px); 
        }
        
        /* --- TR·∫†NG TH√ÅI 2: ƒêANG PH√ÅT NH·∫†C (Vi√™n thu·ªëc trung b√¨nh) --- */
        .island-playing-shrunk {
            width: 170px; 
            height: 36px;
            padding: 0 10px;
            margin-left: 0; 
            transform: translateX(0); /* Reset transform */
            justify-content: space-between;
        }
        
        /* Sound Bar CSS */
        .bar {
            width: 2px;
            margin: 0 0.5px;
            background-color: #34d399; /* Green/Mint */
            animation: soundwave 0.5s infinite alternate;
            transform-origin: bottom;
            border-radius: 1px;
            transition: background-color 0.05s linear; 
        }

        .bar:nth-child(1) { height: 8px; animation-delay: 0.1s; }
        .bar:nth-child(2) { height: 14px; animation-delay: 0.2s; }
        .bar:nth-child(3) { height: 5px; animation-delay: 0.3s; }
        .bar:nth-child(4) { height: 10px; animation-delay: 0.4s; }
        .bar:nth-child(5) { height: 7px; animation-delay: 0.5s; }

        @keyframes soundwave {
            0% { transform: scaleY(0.5); }
            100% { transform: scaleY(1.5); }
        }
        
        /* --- TR·∫†NG TH√ÅI 3: M·ªû R·ªòNG (Full Player) --- */
        .island-expanded {
            width: 350px; 
            height: 480px; 
            padding: 20px;
            border-radius: 40px; 
            flex-direction: column;
            align-items: flex-start;
            margin: 0;
            transform: translateX(0); /* Reset transform */
            cursor: default; 
        }
        
        /* ·∫®n n·ªôi dung khi ·ªü tr·∫°ng th√°i 0 */
        .island-collapsed #island-content {
            opacity: 0; 
        }

        /* --- PHONG C√ÅCH PLAYER M·ªû R·ªòNG --- */
        .expanded-player-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            justify-content: space-between;
        }

        #album-art-large {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .progress-container {
            width: 100%;
            height: 4px;
            background-color: #3a3b3c;
            border-radius: 2px;
            margin: 10px 0;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #fff;
            border-radius: 2px;
        }
        
        .time-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 11px;
            color: #ccc;
        }
        
        .large-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            margin-top: 20px;
        }
        
        .large-controls button {
            background: none;
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        
        .large-controls button:active {
            transform: scale(0.9);
        }
        
        .play-pause-btn-large svg {
            width: 48px;
            height: 48px;
        }
        
        .skip-btn-large svg {
            width: 28px;
            height: 28px;
        }

        /* --- PHONG C√ÅCH ·ª®NG D·ª§NG FACEBOOK (Thu nh·ªè n√∫t) --- */
        .facebook-app {
            padding-top: 70px; /* Gi·∫£m padding */
        }
        
        .button-group { 
            padding: 8px; /* Gi·∫£m padding */
            gap: 6px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
        }
        .action-btn { 
            padding: 6px 10px; /* Gi·∫£m padding n√∫t */
            border-radius: 6px; /* Gi·∫£m bo g√≥c */
            font-size: 12px; /* Gi·∫£m font size */
        }
        .music-controls {
            justify-content: center;
            gap: 15px;
        }

        /* C√°c style c√≤n l·∫°i */
        .fb-logo { font-size: 26px; font-weight: bold; color: var(--fb-blue); text-align: left; }
        .fb-post-card { background-color: var(--card-bg); margin: 10px 0; padding: 15px; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease; }
        .post-actions-bar { padding-top: 10px; border-top: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 15px; transition: border-color 0.3s ease; }
        .video-btn, .avatar-btn { color: white; background-image: linear-gradient(135deg, var(--fb-blue) 0%, #3b90ff 100%); }
        .video-btn:hover, .avatar-btn:hover { background-image: linear-gradient(135deg, #166fe5 0%, #2d88ff 100%); box-shadow: 0 4px 10px rgba(24, 119, 242, 0.4); top: -1px; }
        .post-header { display: flex; align-items: center; margin-bottom: 10px; }
        .profile-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover; border: 1px solid #eee; }
        .user-details { display: flex; align-items: center; flex-wrap: wrap; }
        .user-name { font-weight: 700; font-size: 14px; color: var(--text-color); margin-right: 5px; transition: color 0.3s ease; cursor: pointer; }
        .verified-tick { display: inline-block; width: 16px; height: 16px; background-size: cover; margin-top: -3px; margin-left: 2px; flex-shrink: 0; transition: filter 0.3s ease; }
        .post-time { font-size: 12px; color: #606770; width: 100%; }
        .post-content { margin-bottom: 15px; }
        #video-player { position: relative; width: 100%; padding-top: 56.25%; background-color: #000; border-radius: 12px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        #video-player iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        #video-art-player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #1a1a1a; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #ccc; font-size: 16px; border-radius: 12px; opacity: 1; transition: opacity 0.3s ease; }
        .video-art-icon { font-size: 40px; margin-bottom: 10px; }
        #target-text { font-size: 18px; font-weight: bold; padding: 10px 0; color: var(--text-color); transition: color 0.3s ease; cursor: pointer; }
        .dynamic-text-span { transition: color 0.3s ease; }
        .button-group-label { font-weight: bold; font-size: 10px; text-transform: uppercase; color: #606770; width: 100%; margin-bottom: -5px; }
        .input-group { display: flex; gap: 8px; width: 100%; }
        .input-group input { flex-grow: 1; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--input-border); background-color: var(--input-bg); color: var(--text-color); transition: border-color 0.2s; }
        .input-group input:focus { border-color: var(--fb-blue); outline: none; }
        
    </style>
</head>
<body class=""> 
    
    <div id="music-glow-background"></div>

    <div class="iphone-container">
        <div class="iphone-frame">
            <div class="screen">
                
                <div class="status-bar">
                    <span id="vietnam-time" class="time">9:41</span>
                    
                    <div class="flex items-center space-x-1.5" id="statusBarIconsGroup">
                        
                        <div id="cellSignal" class="flex items-end h-3 space-x-[1px] opacity-90 text-current">
                            <div class="signal-bar signal-bar-1 opacity-90"></div>
                            <div class="signal-bar signal-bar-2 opacity-90"></div>
                            <div class="signal-bar signal-bar-3 opacity-90"></div>
                            <div class="signal-bar signal-bar-4 opacity-50"></div>
                        </div>

                        <svg id="wifiIcon" class="icon-svg opacity-90" viewBox="0 0 24 24">
                            <path d="M5 12.55C6.88 10.2 9.54 9 12 9s5.12 1.2 7 3.55M1.49 9C3.76 6.31 7.21 5 12 5s8.24 1.31 10.51 4M8.53 15C9.43 13.9 10.66 13.2 12 13.2s2.57.7 3.47 1.8M12 18.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                        </svg>

                        <div id="batteryGroup" class="flex items-center text-[13px] font-medium">
                            <span id="batteryPercent" class="mr-1 transition-colors duration-50">75%</span>
                            <div id="batteryShell" class="battery-container text-current">
                                <div id="batteryFill" class="battery-fill"></div>
                            </div>
                            <div id="batteryCap" class="battery-cap text-current"></div>
                        </div>

                    </div>
                </div>
                
                <div class="dynamic-island-wrapper">
                    <div id="dynamic-island-notch"></div> 
                    
                    <div id="dynamic-island" class="island-collapsed">
                        
                        <div id="island-content">
                            
                            <div id="music-playing-shrunk-content" class="flex items-center space-x-2 w-full justify-between">
                                <div id="shrunk-time" class="text-sm font-bold" style="color:#34d399;">0:00</div>
                                
                                <div id="sound-bars-shrunk" class="flex items-end h-5 space-x-0.5">
                                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                                </div>
                                
                                <span class="text-yellow-400">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21a1 1 0 0 1-1-1v-4.382A7 7 0 0 1 5 12a7 7 0 0 1 6-4.618V4a1 1 0 0 1 2 0v4.382A7 7 0 0 1 19 12a7 7 0 0 1-6 4.618V20a1 1 0 0 1-1 1z"/></svg>
                                </span>
                            </div>
                            
                            <div id="music-expanded-player" class="expanded-player-content hidden">
                                
                                <div class="flex flex-col items-center w-full">
                                    <img id="album-art-large" src="https://placehold.co/400x400/000000/ff5e00?text=ART" alt="Album Art">
                                    <div class="text-center mb-6">
                                        <span id="track-title-expanded" class="text-2xl font-bold block">Ti√™u ƒê·ªÅ B√†i H√°t</span>
                                        <span id="track-artist-expanded" class="text-lg font-light text-gray-400 block">Ca Sƒ©</span>
                                    </div>
                                </div>
                                
                                <div class="w-full">
                                    <div class="progress-container">
                                        <div id="progress-bar-fill" class="progress-bar"></div>
                                    </div>
                                    <div class="time-labels">
                                        <span id="current-time-label">0:00</span>
                                        <span id="remaining-time-label">-3:41</span>
                                    </div>
                                </div>
                                
                                <div class="large-controls">
                                    <button class="skip-btn-large">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M11 18V6l-7 6 7 6zm3-12v12l7-6-7-6z"/></svg>
                                    </button>
                                    <button id="toggle-play-pause-large" class="play-pause-btn-large">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 3v18l12-9-12-9z"/></svg>
                                    </button>
                                    <button class="skip-btn-large">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M13 18V6l7 6-7 6zm-7-6-7 6V6l7 6z"/></svg>
                                    </button>
                                </div>
                                
                                <div class="volume-icon absolute bottom-5 right-5">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21a1 1 0 0 1-1-1v-4.382A7 7 0 0 1 5 12a7 7 0 0 1 6-4.618V4a1 1 0 0 1 2 0v4.382A7 7 0 0 1 19 12a7 7 0 0 1-6 4.618V20a1 1 0 0 1-1 1z"/></svg>
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="facebook-app">
                    
                    <div class="fb-header">
                        <h1 class="fb-logo">facebook</h1>
                    </div>

                    <div class="fb-post-card">
                        
                        <div class="post-header">
                            <img id="avatar-image" src="https://via.placeholder.com/50/007bff/ffffff?text=TD" alt="·∫¢nh ƒê·∫°i Di·ªán" class="profile-avatar">
                            <div class="user-details">
                                <span class="user-name dynamic-text-span" id="userName">Tr·∫ßn Duy B·∫£o</span>
                                <span class="verified-tick" id="verifiedTick" title="ƒê√£ x√°c minh"></span>
                                <p class="post-time">1 ph√∫t tr∆∞·ªõc</p>
                            </div>
                        </div>
                        
                        <div class="post-content">
                            
                            <div id="video-player">
                                <div id="video-art-player">
                                    <span class="video-art-icon">‚ñ∂Ô∏è</span>
                                    <p>D√°n li√™n k·∫øt YouTube ƒë·ªÉ xem video</p>
                                </div>
                            </div>
                            
                            <h3 id="target-text" class="dynamic-text-span">ƒê√¢y l√† d√≤ng ch·ªØ s·∫Ω thay ƒë·ªïi m√†u s·∫Øc!</h3>
                            
                        </div>
                        
                        <div class="post-actions-bar">
                            
                            <div class="input-group">
                                <input type="text" id="youtube-link-input" placeholder="D√°n Li√™n K·∫øt YouTube (v√≠ d·ª•: https://youtu.be/dQw4w9WgXcQ)">
                                <button id="load-video-btn" class="action-btn video-btn">‚ñ∂ T·∫£i Video</button>
                            </div>
                            
                            <div class="button-group">
                                <span class="button-group-label">DYNAMIC ISLAND (NH·∫†C)</span>
                                <input type="file" id="art-file-input" accept="image/*" style="display: none;">
                                <button id="upload-art-btn" class="action-btn avatar-btn">üñºÔ∏è T·∫£i ·∫¢nh Art Nh·∫°c</button>
                                <button id="update-track-info-btn" class="action-btn video-btn">üéµ ƒê·ªïi T√™n/Ca Sƒ©</button>
                                <div class="music-controls w-full flex-wrap">
                                    <button id="toggle-tick-rgb-btn" class="action-btn flex-grow">‚úÖ B·∫≠t/T·∫Øt Nh·∫°c & RGB</button>
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <span class="button-group-label">VƒÇN B·∫¢N (T√äN NG∆Ø·ªúI D√ôNG)</span>
                                <button id="change-name-btn" class="action-btn avatar-btn">üë§ Thay ƒê·ªïi T√™n</button>
                                <button id="name-rgb-btn" class="action-btn">üé® RGB Quay V√≤ng</button>
                                <button id="name-reset-btn" class="action-btn">‚ùå ƒê·∫∑t L·∫°i M√†u</button>
                            </div>
                            
                            <div class="button-group">
                                <span class="button-group-label">VƒÇN B·∫¢N (TI√äU ƒê·ªÄ B√ÄI VI·∫æT)</span>
                                <button id="change-text-btn" class="action-btn">‚úèÔ∏è Thay ƒê·ªïi N·ªôi Dung</button>
                                <button id="text-rgb-btn" class="action-btn">üé® RGB Quay V√≤ng</button>
                                <button id="text-reset-btn" class="action-btn">‚ùå ƒê·∫∑t L·∫°i M√†u</button>
                            </div>

                            <div class="button-group">
                                <span class="button-group-label">KH√ÅC</span>
                                <input type="file" id="avatar-file-input" accept="image/*" style="display: none;">
                                <button id="upload-avatar-btn" class="action-btn avatar-btn">üì∑ T·∫£i ·∫¢nh ƒê·∫°i Di·ªán</button>
                                <button id="toggle-night-mode-btn" class="action-btn">üåô Ch·∫ø ƒë·ªô Ban ƒê√™m</button>
                            </div>
                            
                        </div>
                        
                    </div>
                    
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // --- CH·ªåN PH·∫¶N T·ª¨ & KHAI B√ÅO BI·∫æN ---
        const body = document.body;
        const island = document.getElementById('dynamic-island');
        const musicGlowBackground = document.getElementById('music-glow-background'); 
        
        // Status Bar (M·ªöI)
        const timeDisplay = document.getElementById('vietnam-time');
        const statusBarIconsGroup = document.getElementById('statusBarIconsGroup');
        const cellSignalEl = document.getElementById('cellSignal');
        const wifiIconEl = document.getElementById('wifiIcon');
        const batteryGroupEl = document.getElementById('batteryGroup');
        const batteryPercentEl = document.getElementById('batteryPercent');
        const batteryShellEl = document.getElementById('batteryShell');
        const batteryFillEl = document.getElementById('batteryFill');
        const batteryCapEl = document.getElementById('batteryCap');
        const signalBars = cellSignalEl.querySelectorAll('.signal-bar');
        
        // Dynamic Island
        const islandNotch = document.getElementById('dynamic-island-notch');
        const musicPlayingShrunkContent = document.getElementById('music-playing-shrunk-content');
        const musicExpandedPlayer = document.getElementById('music-expanded-player');
        const albumArtLargeImg = document.getElementById('album-art-large');
        const shrunkTimeDisplay = document.getElementById('shrunk-time');
        const currentTimeLabel = document.getElementById('current-time-label');
        const remainingTimeLabel = document.getElementById('remaining-time-label');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const trackTitleExpanded = document.getElementById('track-title-expanded');
        const trackArtistExpanded = document.getElementById('track-artist-expanded');
        const togglePlayPauseLargeBtn = document.getElementById('toggle-play-pause-large');
        
        // Video
        const youtubeLinkInput = document.getElementById('youtube-link-input');
        const loadVideoBtn = document.getElementById('load-video-btn');
        const videoPlayer = document.getElementById('video-player');
        const videoArtPlayer = document.getElementById('video-art-player');

        // H·ªì S∆° & VƒÉn b·∫£n
        const userNameSpan = document.getElementById('userName'); 
        const verifiedTickSpan = document.getElementById('verifiedTick');
        const targetText = document.getElementById('target-text');

        // N√∫t Dynamic Island
        const uploadArtBtn = document.getElementById('upload-art-btn');
        const artFileInput = document.getElementById('art-file-input');
        const updateTrackInfoBtn = document.getElementById('update-track-info-btn');
        const toggleDynamicTickBtn = document.getElementById('toggle-tick-rgb-btn');
        const toggleNightModeBtn = document.getElementById('toggle-night-mode-btn');

        // --- Bi·∫øn Tr·∫°ng Th√°i ---
        let globalIntervals = {}; 
        let headerRgbInterval = null; 
        let isNightMode = false;
        let hue = 0; 
        let currentTrack = "Entropy"; // Default track name
        let currentArtist = "Beach Bunny"; // Default artist name
        let defaultAlbumArt = "https://placehold.co/400x400/000000/ff5e00?text=ART";
        
        // Dynamic Island State Machine
        // 0: Collapsed (Notch) | 1: Playing Shrunk (Medium Pill) | 2: Expanded (Full Player)
        let islandState = 0; 
        const totalDurationSeconds = 221; // 3:41
        let currentProgressSeconds = 0;
        let progressInterval = null;
        
        // Pin v√† Th·ªùi gian (M·ªöI)
        let currentBatteryLevel = 75; // M·ª©c pin gi·∫£ l·∫≠p ban ƒë·∫ßu
        const BATTERY_COLORS = {
            green: 'bg-green-500',
            yellow: 'bg-yellow-400',
            red: 'bg-red-500'
        };

        // ===================================
        // --- LOGIC KH·ªûI T·∫†O ---
        // ===================================

        document.addEventListener('DOMContentLoaded', () => {
            updateNameAndTickColors();
            albumArtLargeImg.src = defaultAlbumArt;
            videoArtPlayer.innerHTML = `<img src="${defaultAlbumArt}" alt="Video Art" style="width:100%; height:100%; object-fit:cover; border-radius:12px;">`;

            updateTrackDisplay();
            updateTime();
            updateBattery(currentBatteryLevel);
            
            // C·∫≠p nh·∫≠t th·ªùi gian m·ªói gi√¢y
            setInterval(updateTime, 1000); 
            // Gi·∫£ l·∫≠p Pin gi·∫£m d·∫ßn (ch·ªâ ƒë·ªÉ demo)
            setInterval(() => {
                currentBatteryLevel = (currentBatteryLevel - 1);
                if (currentBatteryLevel < 0) currentBatteryLevel = 100;
                updateBattery(currentBatteryLevel);
            }, 3000); 
            
            // Kh·ªüi t·∫°o tr·∫°ng th√°i ƒê·∫£o ƒê·ªông
            setIslandState(0);
        });
        
        // --- LOGIC STATUS BAR M·ªöI (Th·ªùi gian, Pin) ---
        function updateTime() {
            const options = { 
                timeZone: 'Asia/Ho_Chi_Minh', 
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: false 
            };
            const vnTime = new Date().toLocaleTimeString('en-US', options);
            timeDisplay.textContent = vnTime;
        }

        function updateBattery(level) {
            const percent = Math.max(0, Math.min(100, level)); 
            
            // 1. C·∫≠p nh·∫≠t ch·ªØ hi·ªÉn th·ªã
            batteryPercentEl.textContent = `${percent}%`;

            // 2. C·∫≠p nh·∫≠t chi·ªÅu r·ªông thanh Pin
            batteryFillEl.style.width = `${percent}%`;

            // 3. C·∫≠p nh·∫≠t m√†u s·∫Øc (N·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô RGB, logic n√†y b·ªã b·ªè qua)
            if (!headerRgbInterval) {
                // ƒê·∫∑t l·∫°i m√†u pin m·∫∑c ƒë·ªãnh cho ch·∫ø ƒë·ªô Tƒ©nh
                Object.values(BATTERY_COLORS).forEach(cls => batteryFillEl.classList.remove(cls));
                
                let iconColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();

                if (percent <= 20) {
                    // M·ª©c pin y·∫øu (m√†u ƒë·ªè)
                    batteryFillEl.classList.add(BATTERY_COLORS.red);
                    iconColor = '#ef4444'; // Tailwind red-500
                    
                    // Hi·ªáu ·ª©ng "Pin y·∫øu" (nh·∫•p nh√°y)
                    if (percent < 10) {
                        batteryFillEl.style.animation = 'blink 1s steps(1, end) infinite';
                    } else {
                        batteryFillEl.style.animation = 'none';
                    }
                } else if (percent <= 50) {
                    // M·ª©c pin trung b√¨nh (m√†u v√†ng)
                    batteryFillEl.classList.add(BATTERY_COLORS.yellow);
                    batteryFillEl.style.animation = 'none';
                } else {
                    // M·ª©c pin ƒë·∫ßy (m√†u xanh l√°)
                    batteryFillEl.classList.add(BATTERY_COLORS.green);
                    batteryFillEl.style.animation = 'none';
                }
                
                // C·∫≠p nh·∫≠t m√†u border v√† cap
                batteryShellEl.style.borderColor = iconColor;
                batteryCapEl.style.backgroundColor = iconColor;
                updateStatusBarColor(iconColor, false); // √Åp d·ª•ng m√†u cho c√°c icon kh√°c
            }
        }
        
        // H√†m c·∫≠p nh·∫≠t m√†u cho to√†n b·ªô Status Bar
        function updateStatusBarColor(color, isRgb = true) {
            const textColor = isRgb ? color : color;
            
            // C·∫≠p nh·∫≠t m√†u ch·ªØ (Time, Percent)
            timeDisplay.style.color = textColor;
            batteryPercentEl.style.color = textColor;
            
            // C·∫≠p nh·∫≠t m√†u Icons (Signal, Wifi)
            wifiIconEl.style.stroke = textColor;
            signalBars.forEach(bar => bar.style.backgroundColor = textColor);
            
            if (isRgb) {
                // Khi RGB, pin fill lu√¥n m√†u tr·∫Øng
                batteryShellEl.style.borderColor = textColor;
                batteryCapEl.style.backgroundColor = textColor;
                batteryFillEl.style.backgroundColor = 'white'; 
                batteryFillEl.style.animation = 'none'; // T·∫Øt nh·∫•p nh√°y
                Object.values(BATTERY_COLORS).forEach(cls => batteryFillEl.classList.remove(cls));
            } else {
                // Khi Tƒ©nh, ch·ªâ c·∫≠p nh·∫≠t border/cap/icon, pin fill ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi updateBattery
                const defaultIconColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
                timeDisplay.style.color = defaultIconColor;
                batteryPercentEl.style.color = defaultIconColor;
                wifiIconEl.style.stroke = defaultIconColor;
                signalBars.forEach(bar => bar.style.backgroundColor = defaultIconColor);

                // Update battery shell/cap color based on default text color
                batteryShellEl.style.borderColor = defaultIconColor;
                batteryCapEl.style.backgroundColor = defaultIconColor;
            }
        }

        // --- Logic Dynamic Island (ƒê√£ s·ª≠a l·ªói hi·ªÉn th·ªã Collapsed) ---

        // H√†m ƒë·ªãnh d·∫°ng th·ªùi gian
        function formatTime(totalSeconds) {
            const sign = totalSeconds < 0 ? '-' : '';
            const seconds = Math.abs(totalSeconds);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${sign}${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // C·∫≠p nh·∫≠t UI cho b√†i h√°t
        function updateTrackDisplay() {
            trackTitleExpanded.textContent = currentTrack;
            trackArtistExpanded.textContent = currentArtist;
            
            currentTimeLabel.textContent = formatTime(currentProgressSeconds);
            const remaining = totalDurationSeconds - currentProgressSeconds;
            remainingTimeLabel.textContent = formatTime(-remaining);
            
            shrunkTimeDisplay.textContent = formatTime(currentProgressSeconds);

            const percent = (currentProgressSeconds / totalDurationSeconds) * 100;
            progressBarFill.style.width = `${percent}%`;
        }

        // Qu·∫£n l√Ω tr·∫°ng th√°i Dynamic Island
        function setIslandState(newState) {
            islandState = newState;
            
            island.classList.remove('island-playing-shrunk', 'island-expanded', 'island-collapsed');
            musicPlayingShrunkContent.style.display = 'none';
            musicExpandedPlayer.style.display = 'none';
            
            // --- Logic S·ª≠a L·ªói Notch ---
            
            if (islandState === 0) {
                 island.style.opacity = '0'; // ·∫®n DI ƒë·ªÉ ch·ªâ l·ªô Notch g·ªëc
                 islandNotch.style.opacity = '1'; // Hi·ªán Notch g·ªëc
                 stopMusicRgbAndProgress();
                 
            } else {
                 island.style.opacity = '1'; // Hi·ªán DI
                 islandNotch.style.opacity = '0'; // ·∫®n Notch g·ªëc
                 startMusicRgbAndProgress();
            }

            // --- C·∫≠p nh·∫≠t Class v√† Display ---
            
            switch (islandState) {
                case 0: // Collapsed (Ch·ªâ l·ªô Notch)
                    island.classList.add('island-collapsed');
                    break;
                case 1: // Playing Shrunk
                    island.classList.add('island-playing-shrunk');
                    musicPlayingShrunkContent.style.display = 'flex';
                    break;
                case 2: // Expanded
                    island.classList.add('island-expanded');
                    musicExpandedPlayer.style.display = 'flex';
                    break;
            }
        }
        
        // Logic Ti·∫øn tr√¨nh
        function startProgress() {
            if (progressInterval) clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                currentProgressSeconds++;
                if (currentProgressSeconds > totalDurationSeconds) {
                    currentProgressSeconds = 0; // Loop
                }
                updateTrackDisplay();
            }, 1000);
            
            togglePlayPauseLargeBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        }

        function stopProgress() {
            if (progressInterval) clearInterval(progressInterval);
            progressInterval = null;
            
            togglePlayPauseLargeBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 3v18l12-9-12-9z"/></svg>';
        }

        // Logic RGB (ƒê√£ s·ª≠a ƒë·ªïi ƒë·ªÉ bao g·ªìm Status Bar M·ªöI)
        function updateMusicGlow() {
            const color1 = `hsl(${hue}, 80%, 30%)`;
            const color2 = `hsl(${(hue + 60) % 360}, 80%, 30%)`;
            
            musicGlowBackground.style.background = `radial-gradient(circle at 50% 50%, ${color1} 0%, ${color2} 100%)`;
        }
        
        function startMusicGlow() {
            musicGlowBackground.style.filter = 'blur(100px) opacity(0.8)'; 
        }

        function stopMusicGlow() {
            musicGlowBackground.style.filter = 'blur(100px) opacity(0)'; 
        }
        
        function startMusicRgbAndProgress() {
            
            if (headerRgbInterval) return; 
            
            startMusicGlow(); 

            let step = 0;
            
            headerRgbInterval = setInterval(() => {
                const r = Math.sin(step) * 127 + 128;
                const g = Math.sin(step + 2) * 127 + 128;
                const b = Math.sin(step + 4) * 127 + 128;
                
                const rgbString = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;

                // C·∫≠p nh·∫≠t m√†u Status Bar (S·ª≠ d·ª•ng h√†m m·ªõi)
                updateStatusBarColor(rgbString, true);

                // C·∫≠p nh·∫≠t m√†u Tick v√† Soundwave
                updateNameAndTickColors(rgbString); 
                
                document.querySelectorAll('.bar').forEach(bar => bar.style.backgroundColor = rgbString);
                shrunkTimeDisplay.style.color = rgbString;

                // C·∫≠p nh·∫≠t Glow Background
                hue = (hue + 5) % 360; 
                updateMusicGlow();

                step += 0.05; 
            }, 50);
            
            // Lu√¥n ƒë·∫£m b·∫£o ti·∫øn tr√¨nh ch·∫°y khi RGB/Nh·∫°c ƒë∆∞·ª£c b·∫≠t
            if (islandState !== 0) {
                 startProgress();
            }
        }

        function stopMusicRgbAndProgress() {
            stopProgress();
            
            if (headerRgbInterval) {
                clearInterval(headerRgbInterval);
                headerRgbInterval = null;
            }
            
            stopMusicGlow(); 

            // Reset m√†u Status Bar v·ªÅ m·∫∑c ƒë·ªãnh tƒ©nh
            updateStatusBarColor(null, false);
            updateBattery(currentBatteryLevel); // Kh√¥i ph·ª•c l·∫°i logic m√†u pin tƒ©nh
            
            // Reset Soundwave v√† Tick
            document.querySelectorAll('.bar').forEach(bar => bar.style.backgroundColor = '#34d399');
            shrunkTimeDisplay.style.color = '#34d399';
            updateNameAndTickColors();
        }

        // ===================================
        // --- LOGIC G·∫ÆN S·ª∞ KI·ªÜN ---
        // ===================================

        // Logic Toggle Dynamic Island (0 <-> 1/2)
        toggleDynamicTickBtn.addEventListener('click', () => {
            let newState;
            if (islandState === 0) {
                newState = 1; // B·∫≠t -> Ch·∫ø ƒë·ªô Playing Shrunk
                toggleDynamicTickBtn.textContent = '‚è∏ D·ª´ng Nh·∫°c & RGB (ƒêang ho·∫°t ƒë·ªông)';
            } else {
                newState = 0; // T·∫Øt -> Ch·∫ø ƒë·ªô Collapsed
                toggleDynamicTickBtn.textContent = '‚úÖ B·∫≠t/T·∫Øt Nh·∫°c & RGB';
            }
            setIslandState(newState);
        });
        
        // Click v√†o Dynamic Island ƒë·ªÉ chuy·ªÉn tr·∫°ng th√°i 1 <-> 2
        island.addEventListener('click', () => {
            // Ch·ªâ chuy·ªÉn tr·∫°ng th√°i n·∫øu kh√¥ng ph·∫£i tr·∫°ng th√°i 0 (Collapsed)
            if (islandState === 1) {
                setIslandState(2);
            } else if (islandState === 2) {
                setIslandState(1);
            }
        });
        
        // N√∫t Play/Pause l·ªõn trong tr·∫°ng th√°i Expanded
        togglePlayPauseLargeBtn.addEventListener('click', () => {
            if (progressInterval) {
                stopProgress();
            } else {
                startProgress();
            }
        });
        
        // Logic ƒë·ªïi T√™n B√†i h√°t/Ca sƒ© (C·∫≠p nh·∫≠t ƒë·ªÉ s·ª≠ d·ª•ng h√†m updateTrackDisplay)
        updateTrackInfoBtn.addEventListener('click', () => {
            const newTrack = prompt('Nh·∫≠p Ti√™u ƒë·ªÅ B√†i h√°t m·ªõi:', currentTrack);
            const newArtist = prompt('Nh·∫≠p T√™n Ca sƒ© m·ªõi:', currentArtist);
            
            if (newTrack !== null) {
                currentTrack = newTrack.trim() || "Ti√™u ƒê·ªÅ B√†i H√°t Tuy·ªát V·ªùi";
            }
            if (newArtist !== null) {
                currentArtist = newArtist.trim() || "Tr·∫ßn Duy B·∫£o";
            }
            updateTrackDisplay();
        });

        // T·∫£i ·∫¢nh Art Nh·∫°c
        uploadArtBtn.addEventListener('click', () => {
            artFileInput.click();
        });

        artFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    albumArtLargeImg.src = e.target.result;
                    videoArtPlayer.innerHTML = `<img src="${e.target.result}" alt="Video Art" style="width:100%; height:100%; object-fit:cover; border-radius:12px;">`;
                };
                reader.readAsDataURL(file);
            } else if (file) {
                console.error('Vui l√≤ng ch·ªçn m·ªôt t·ªáp h√¨nh ·∫£nh h·ª£p l·ªá cho Art Nh·∫°c/Video.');
            }
        });
        
        // --- LOGIC CHUNG M√ÄU S·∫ÆC/VƒÇN B·∫¢N ƒê·ªòNG (Gi·ªØ nguy√™n) ---

        // C·∫≠p nh·∫≠t m√†u T√™n v√† Tick (Tƒ©nh ho·∫∑c RGB)
        function updateNameAndTickColors(color) {
            const defaultNameColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
            if (!globalIntervals['userName']) {
                userNameSpan.style.color = defaultNameColor;
            }

            const defaultTickColor = getComputedStyle(document.documentElement).getPropertyValue('--fb-blue').trim();
            const newColor = color || defaultTickColor; 

            // C·∫≠p nh·∫≠t Tick
            const svgData = encodeURIComponent(`
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>
                    <path fill='${newColor}' d='M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.707 7.707-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11.5 12.086l3.293-3.293a1 1 0 0 1 1.414 1.414z'/>
                </svg>
            `);
            verifiedTickSpan.style.backgroundImage = `url("data:image/svg+xml,${svgData}")`;
        }
        
        function resetDynamicText(element) {
            const id = element.id;
            if (globalIntervals[id]) {
                clearInterval(globalIntervals[id]);
                delete globalIntervals[id];
            }
            element.innerHTML = element.textContent; 
            const defaultColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
            element.style.color = defaultColor;
            if (id === 'userName') { updateNameAndTickColors(); }
        }

        function setRgbCycleText(element) {
            resetDynamicText(element);
            const id = element.id;
            let step = 0;

            const text = element.textContent;
            element.innerHTML = [...text].map(char => 
                `<span style="transition: color 0.1s ease;">${char}</span>`
            ).join('');
            
            const chars = element.querySelectorAll('span');

            globalIntervals[id] = setInterval(() => {
                chars.forEach((char, i) => {
                    if (char.textContent.trim() === '') return;
                    const r = Math.sin(0.1 * i + step) * 127 + 128;
                    const g = Math.sin(0.1 * i + step + 2) * 127 + 128;
                    const b = Math.sin(0.1 * i + step + 4) * 127 + 128;
                    char.style.color = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
                });
                step += 0.1; 
            }, 50); 
        }
        
        document.getElementById('change-text-btn').addEventListener('click', () => {
            const newText = prompt('Nh·∫≠p n·ªôi dung m·ªõi cho ti√™u ƒë·ªÅ b√†i vi·∫øt:');
            if (newText !== null) {
                resetDynamicText(targetText); 
                targetText.textContent = newText.trim() || 'ƒê√¢y l√† d√≤ng ch·ªØ s·∫Ω thay ƒë·ªïi m√†u s·∫Øc!';
            }
        });
        document.getElementById('change-name-btn').addEventListener('click', () => {
            const newName = prompt('Nh·∫≠p t√™n m·ªõi cho h·ªì s∆° Facebook c·ªßa b·∫°n:');
            if (newName && newName.trim() !== "") {
                resetDynamicText(userNameSpan); 
                userNameSpan.textContent = newName.trim();
                updateNameAndTickColors();
            }
        });
        
        document.getElementById('text-rgb-btn').addEventListener('click', () => setRgbCycleText(targetText));
        document.getElementById('text-reset-btn').addEventListener('click', () => resetDynamicText(targetText));
        document.getElementById('name-rgb-btn').addEventListener('click', () => setRgbCycleText(userNameSpan));
        document.getElementById('name-reset-btn').addEventListener('click', () => resetDynamicText(userNameSpan));
        
        document.getElementById('upload-avatar-btn').addEventListener('click', () => {
            document.getElementById('avatar-file-input').click();
        });
        document.getElementById('avatar-file-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('avatar-image').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Chuy·ªÉn ƒë·ªïi Ch·∫ø ƒë·ªô Ban ƒê√™m
        toggleNightModeBtn.addEventListener('click', () => {
            isNightMode = !isNightMode;
            body.classList.toggle('night-mode', isNightMode);
            toggleNightModeBtn.textContent = isNightMode ? '‚òÄÔ∏è Ch·∫ø ƒë·ªô Ban Ng√†y' : 'üåô Ch·∫ø ƒë·ªô Ban ƒê√™m';
            
            setIslandState(0);
            
            // ƒê·∫∑t l·∫°i m√†u Status Bar m·∫∑c ƒë·ªãnh
            updateStatusBarColor(null, false);
            updateBattery(currentBatteryLevel);

            updateNameAndTickColors();
            for (const id in globalIntervals) {
                if (globalIntervals.hasOwnProperty(id)) {
                    resetDynamicText(document.getElementById(id));
                }
            }
        });
        
        // --- LOGIC VIDEO YOUTUBE (Gi·ªØ nguy√™n) ---
        function getYouTubeId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return (match && match[1]) ? match[1] : null;
        }

        function loadVideo() {
            const url = youtubeLinkInput.value.trim();
            const videoId = getYouTubeId(url);

            if (videoId) {
                const iframe = document.createElement('iframe');
                iframe.setAttribute('allow', 'autoplay; encrypted-media; gyroscope; picture-in-picture');
                iframe.setAttribute('allowfullscreen', '');
                iframe.setAttribute('src', `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&showinfo=0&rel=0`);
                
                videoPlayer.innerHTML = '';
                videoPlayer.appendChild(iframe);
                
                videoArtPlayer.style.opacity = '0';
                setTimeout(() => { videoArtPlayer.style.display = 'none'; }, 300); 

                console.log(`ƒê√£ t·∫£i video ID: ${videoId}`);
            } else {
                console.error('Vui l√≤ng nh·∫≠p li√™n k·∫øt YouTube h·ª£p l·ªá.');
                videoArtPlayer.innerHTML = '<span class="video-art-icon">‚ùå</span><p>Li√™n k·∫øt kh√¥ng h·ª£p l·ªá. Vui l√≤ng th·ª≠ l·∫°i.</p>';
                videoArtPlayer.style.display = 'flex';
                videoArtPlayer.style.opacity = '1';
            }
        }

        loadVideoBtn.addEventListener('click', loadVideo);


    </script>
</body>
</html>
</body>
</html>
